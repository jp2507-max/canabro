# Legacy `posts` Table – Usage Audit (2025-07-08)

This file enumerates every code reference that still depends on the **`posts`** table.  It will guide the subsequent refactor to the split-table architecture (`community_questions` and `community_plant_shares`).

## Summary

| Area | File | Lines | Purpose |
|------|------|-------|---------|
| Service Layer | `lib/services/community-service.ts` | 126, 222, 698, 801, 820, 845, 864 | Direct Supabase CRUD operations on `posts` |
| Service Layer | `lib/services/profile-service.ts` | 77 | Counts posts for a user profile |
| Service Layer | `lib/services/storage-cleanup.ts` | 82, 190, 232, 244, 252, 458, 474, 535 | Asset cleanup & bucket list containing `posts` |
| Service Layer (Sync) | `lib/services/sync/data-integrity.ts` | 128, 205, 247, 281, 319, 352, 375, 542, 608 (+ Watermelon collections) | Pull / integrity checks referencing `posts` |
| Service Layer (Sync) | `lib/services/sync/conflict-resolver.ts` | 31 | Case statement for `posts` conflicts |
| Service Types | `lib/services/sync/types.ts` | 65 | Table enum includes `posts` |
| Hooks (Queries) | `lib/hooks/community/usePosts.ts` | all | Primary React Query hook for legacy feed |
| Hooks (Mutations) | `lib/hooks/community/useLikePost.ts` | 40-75 | Like / unlike mutations & optimistic cache keyed on `posts` |
| Hooks (Mutations) | `lib/hooks/community/useDeletePost.ts` | 24-137 | Delete mutations + optimistic updates for `posts` |
| Hooks (Comments) | `lib/hooks/community/useCreateComment.ts` | 80-121 | Comment creation cache updates keyed on `posts` |
| Hooks (Realtime) | `lib/hooks/community/useRealTimeUpdates.ts` | 41-118 | Realtime channel subscribed to `posts` |
| Hooks (Watermelon) | `lib/hooks/useWatermelon.ts` | 58 | Local DB collection for `posts` |
| Model | `lib/models/Post.ts` | — | Watermelon model definition (`static table = 'posts'`) |
| Model Schema | `lib/models/schema.ts` | 179 | Schema entry `name: 'posts'` |
| Model Migrations | `lib/models/migrations.ts` | 20, 71, 204, 386 | Watermelon migration steps for `posts` |
| Model Relationships | `lib/models/Profile.ts` | 52 | `@children('posts')` relationship |
| Data-Integrity | `lib/services/data-integrity.ts` | 104, 157, 189, 203, 324, 340 | Watermelon cleanup & checks |

> **Note**: Additional occurrences are string constants (`'posts'`) used as React Query keys.  These will be removed when hooks are migrated.

## Next Actions
1. **Refactor / remove** all above references, migrating logic to the new tables or deleting obsolete code.
2. **Update WatermelonDB schema**: drop `posts` table, add collections for new content types if local replication is required.
3. **Adjust Supabase Storage cleanup**: remove `posts` bucket handling (superseded by `community-questions` & `community-plant-shares`).
4. **Deprecate React Query hooks** `usePosts`, `useLikePost`, `useDeletePost`, etc., replacing them with the new split-table hooks.
5. **Remove Post model** once all usages are refactored.

---

Generated by Task 3 ‑ Sub-task 3.1 audit stage.  This document will be updated if additional references surface during refactor. 